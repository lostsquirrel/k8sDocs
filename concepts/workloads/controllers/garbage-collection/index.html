<!DOCTYPE html>
<html lang="zh-cn">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>垃圾回收 - Kubernetes</title>
<meta name="description" content="生产级别的容器编排系统">
<meta name="generator" content="Hugo 0.68.3" />
<link href="https://lostsquirrel.github.io/k8sDocsindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/garbage-collection/">
<link rel="stylesheet" href="https://lostsquirrel.github.io/k8sDocs/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://lostsquirrel.github.io/k8sDocs/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://lostsquirrel.github.io/k8sDocs/js/bundle.js"></script><style>
:root {}
</style>
<meta property="og:title" content="垃圾回收" />
<meta property="og:description" content="在 k8s 中垃圾回收的作用就是删除那些曾经有所有者，现在没有的对象。 controllers/replicaset.yaml apiVersion: apps/v1 kind: ReplicaSet metadata: name: my-repset spec: replicas: 3 selector: matchLabels: pod-is-for: garbage-collection-example template: metadata: labels: pod-is-for: garbage-collection-example spec: containers: - name: nginx image: nginx If you create the ReplicaSet and then view the Pod metadata, you" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/garbage-collection/" />
<meta property="article:published_time" content="2020-08-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-31T00:00:00+00:00" /><meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="垃圾回收"/>
<meta name="twitter:description" content="在 k8s 中垃圾回收的作用就是删除那些曾经有所有者，现在没有的对象。 controllers/replicaset.yaml apiVersion: apps/v1 kind: ReplicaSet metadata: name: my-repset spec: replicas: 3 selector: matchLabels: pod-is-for: garbage-collection-example template: metadata: labels: pod-is-for: garbage-collection-example spec: containers: - name: nginx image: nginx If you create the ReplicaSet and then view the Pod metadata, you"/>
<meta itemprop="name" content="垃圾回收">
<meta itemprop="description" content="在 k8s 中垃圾回收的作用就是删除那些曾经有所有者，现在没有的对象。 controllers/replicaset.yaml apiVersion: apps/v1 kind: ReplicaSet metadata: name: my-repset spec: replicas: 3 selector: matchLabels: pod-is-for: garbage-collection-example template: metadata: labels: pod-is-for: garbage-collection-example spec: containers: - name: nginx image: nginx If you create the ReplicaSet and then view the Pod metadata, you">
<meta itemprop="datePublished" content="2020-08-31T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-08-31T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1522">



<meta itemprop="keywords" content="" />
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?46e26ffc9d975f663dff0b89f1cf7931";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<link rel="stylesheet" href=/k8sDocs/css/base_fonts.css>

<link rel="stylesheet" href="/k8sDocs/css/jquery-ui.min.css">
<link rel="stylesheet" href="/k8sDocs/css/callouts.css">
<link rel="stylesheet" href="/k8sDocs/css/custom.css">
<link rel="stylesheet" href="/k8sDocs/css/custom-jekyll/tags.css">

</head>
<body><div class="container"><header>
<h1>Kubernetes</h1>

 <span class="version">Version v1.19</span>

<p class="description">生产级别的容器编排系统</p>

</header>

<div class="content-container">
<main><h1>垃圾回收</h1>
<!--  
---
title: Garbage Collection
content_type: concept
weight: 60
---
-->
<!-- overview -->
<p>在 k8s 中垃圾回收的作用就是删除那些曾经有所有者，现在没有的对象。</p>
<!-- body -->
<!--
## Owners and dependents

Some Kubernetes objects are owners of other objects. For example, a ReplicaSet
is the owner of a set of Pods. The owned objects are called *dependents* of the
owner object. Every dependent object has a `metadata.ownerReferences` field that
points to the owning object.

Sometimes, Kubernetes sets the value of `ownerReference` automatically. For
example, when you create a ReplicaSet, Kubernetes automatically sets the
`ownerReference` field of each Pod in the ReplicaSet. In 1.8, Kubernetes
automatically sets the value of `ownerReference` for objects created or adopted
by ReplicationController, ReplicaSet, StatefulSet, DaemonSet, Deployment, Job
and CronJob.

You can also specify relationships between owners and dependents by manually
setting the `ownerReference` field.

Here's a configuration file for a ReplicaSet that has three Pods:



 













<table class="includecode" id="controllersreplicasetyaml">
    <thead>
        <tr>
            <th>
                <a href="https://%25!s%28%3cnil%3e%29/master/content/zh/examples/controllers/replicaset.yaml" download="controllers/replicaset.yaml">
                    <code>controllers/replicaset.yaml</code>
                </a>
                <img src="/k8sDocs/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('controllersreplicasetyaml')" title="Copy controllers/replicaset.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: apps/v1
<span style="color:#66d9ef">kind</span>: ReplicaSet
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: my-repset
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">replicas</span>: <span style="color:#ae81ff">3</span>
  <span style="color:#66d9ef">selector</span>:
    <span style="color:#66d9ef">matchLabels</span>:
      <span style="color:#66d9ef">pod-is-for</span>: garbage-collection-example
  <span style="color:#66d9ef">template</span>:
    <span style="color:#66d9ef">metadata</span>:
      <span style="color:#66d9ef">labels</span>:
        <span style="color:#66d9ef">pod-is-for</span>: garbage-collection-example
    <span style="color:#66d9ef">spec</span>:
      <span style="color:#66d9ef">containers</span>:
      - <span style="color:#66d9ef">name</span>: nginx
        <span style="color:#66d9ef">image</span>: nginx
</code></pre></div>  </td>
        </tr>
    </tbody>
</table>



If you create the ReplicaSet and then view the Pod metadata, you can see
OwnerReferences field:

```shell
kubectl apply -f https://k8s.io/examples/controllers/replicaset.yaml
kubectl get pods --output=yaml
```

The output shows that the Pod owner is a ReplicaSet named `my-repset`:

```yaml
apiVersion: v1
kind: Pod
metadata:
  ...
  ownerReferences:
  - apiVersion: apps/v1
    controller: true
    blockOwnerDeletion: true
    kind: ReplicaSet
    name: my-repset
    uid: d9607e19-f88f-11e6-a518-42010a800195
  ...
```

<blockquote class="note">
  <div><strong>说明：</strong> Cross-namespace owner references are disallowed by design. This means:</p>
<ol>
<li>Namespace-scoped dependents can only specify owners in the same namespace,
and owners that are cluster-scoped.</li>
<li>Cluster-scoped dependents can only specify cluster-scoped owners, but not
namespace-scoped owners.</li>
</ol></div>
</blockquote>

 -->
<h2 id="所有者和从属者">所有者和从属者</h2>
<p>有些 k8s 对象是其它对象的所有者。 如，一个 ReplicaSet 就是一个 Pod 集合的所有者。
那些被拥有的对象就叫所有者的 <em>从属者(dependents)</em>， 每个从属者都有一个 <code>metadata.ownerReferences</code>
字段指向它的所有者。</p>
<p>有时候， k8s 会自动添加 <code>ownerReference</code> 的值。 如，当创建一个 ReplicaSet 时， k8s 自动
为这个 ReplicaSet 所属的 Pod 设置 <code>ownerReference</code>。 在 <code>1.8</code> 中， k8s 为创建或捕获对象
自动设置 <code>ownerReference</code>值的对象有 ReplicationController, ReplicaSet, StatefulSet,
DaemonSet, Deployment, Job, CronJob.</p>
<p>用户可以通过设置 <code>ownerReference</code> 字段来手动指定所有者和从属者之间的关系
以下为一个包含 3 个 Pod 的 ReplicaSet 的配置文件:</p>


 













<table class="includecode" id="controllersreplicasetyaml">
    <thead>
        <tr>
            <th>
                <a href="https://%25!s%28%3cnil%3e%29/master/content/zh/examples/controllers/replicaset.yaml" download="controllers/replicaset.yaml">
                    <code>controllers/replicaset.yaml</code>
                </a>
                <img src="/k8sDocs/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('controllersreplicasetyaml')" title="Copy controllers/replicaset.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: apps/v1
<span style="color:#66d9ef">kind</span>: ReplicaSet
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: my-repset
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">replicas</span>: <span style="color:#ae81ff">3</span>
  <span style="color:#66d9ef">selector</span>:
    <span style="color:#66d9ef">matchLabels</span>:
      <span style="color:#66d9ef">pod-is-for</span>: garbage-collection-example
  <span style="color:#66d9ef">template</span>:
    <span style="color:#66d9ef">metadata</span>:
      <span style="color:#66d9ef">labels</span>:
        <span style="color:#66d9ef">pod-is-for</span>: garbage-collection-example
    <span style="color:#66d9ef">spec</span>:
      <span style="color:#66d9ef">containers</span>:
      - <span style="color:#66d9ef">name</span>: nginx
        <span style="color:#66d9ef">image</span>: nginx
</code></pre></div>  </td>
        </tr>
    </tbody>
</table>


<p>如果用户创建了 ReplicaSet 然后查看所属 Pod 的元数据(metadata), 就可以看到 <code>OwnerReferences</code> 字段</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f replicaset.yaml
kubectl get pods --output<span style="color:#f92672">=</span>yaml
</code></pre></div><p>从输出结果可以看到 Pod 的所有者是一个叫 <code>my-repset</code> 的 ReplicaSet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: Pod
<span style="color:#66d9ef">metadata</span>:
  ...
  <span style="color:#66d9ef">ownerReferences</span>:
  - <span style="color:#66d9ef">apiVersion</span>: apps/v1
    <span style="color:#66d9ef">controller</span>: <span style="color:#66d9ef">true</span>
    <span style="color:#66d9ef">blockOwnerDeletion</span>: <span style="color:#66d9ef">true</span>
    <span style="color:#66d9ef">kind</span>: ReplicaSet
    <span style="color:#66d9ef">name</span>: my-repset
    <span style="color:#66d9ef">uid</span>: d9607e19-f88f<span style="color:#ae81ff">-11e6</span>-a518-42010a800195
  ...
</code></pre></div><blockquote class="note">
  <div><strong>说明：</strong> 在设计上跨名字空间的所属关系是不允许的。 这就是说:</p>
<ol>
<li>名字空间作用域内从属者只能指定同一个名字空间的对象为其所有者和集群作用域的所有者</li>
<li>集群作用哉的从属者只能指定集群作用域的所有者，不能指定名字空间作用域的所有者</li>
</ol></div>
</blockquote>

<!--
## Controlling how the garbage collector deletes dependents

When you delete an object, you can specify whether the object's dependents are
also deleted automatically. Deleting dependents automatically is called *cascading
deletion*.  There are two modes of *cascading deletion*: *background* and *foreground*.

If you delete an object without deleting its dependents
automatically, the dependents are said to be *orphaned*.
 -->
<h2 id="控制垃圾回收器怎么删除从属者">控制垃圾回收器怎么删除从属者</h2>
<p>当用户删除一个对象时，可能指定是否同时自动删除它的从属者。 自动删除从属都的行为叫做 <em>级联删除</em>。
级联删除又有两种模式 <em>后台</em> 和 <em>前台</em>。</p>
<p>如果用户在删除一个对象是没有自动删除它的所属者，这些从属者就认为是 <em>孤儿</em></p>
<!--
### Foreground cascading deletion

In *foreground cascading deletion*, the root object first
enters a "deletion in progress" state. In the "deletion in progress" state,
the following things are true:

 * The object is still visible via the REST API
 * The object's `deletionTimestamp` is set
 * The object's `metadata.finalizers` contains the value "foregroundDeletion".

Once the "deletion in progress" state is set, the garbage
collector deletes the object's dependents. Once the garbage collector has deleted all
"blocking" dependents (objects with `ownerReference.blockOwnerDeletion=true`), it deletes
the owner object.

Note that in the "foregroundDeletion", only dependents with
`ownerReference.blockOwnerDeletion=true` block the deletion of the owner object.
Kubernetes version 1.7 added an [admission controller](/docs/reference/access-authn-authz/admission-controllers/#ownerreferencespermissionenforcement) that controls user access to set
`blockOwnerDeletion` to true based on delete permissions on the owner object, so that
unauthorized dependents cannot delay deletion of an owner object.

If an object's `ownerReferences` field is set by a controller (such as Deployment or ReplicaSet),
blockOwnerDeletion is set automatically and you do not need to manually modify this field.
 -->
<h3 id="前台级联删除">前台级联删除</h3>
<p>In <em>foreground cascading deletion</em>, the root object first
enters a &ldquo;deletion in progress&rdquo; state. In the &ldquo;deletion in progress&rdquo; state,
the following things are true:</p>
<p>在使用 <em>前台级联删除</em> 时， 根对象先进入 &ldquo;删除中&rdquo; 状态。 在 &ldquo;删除中&rdquo; 状态时, 以下状态为真:</p>
<ul>
<li>依然可以通过 REST API 访问该对象</li>
<li>该对象上已经设置了 <code>deletionTimestamp</code></li>
<li>该对象上的 <code>metadata.finalizers</code> 包含值 &ldquo;foregroundDeletion&rdquo;</li>
</ul>
<p>当 &ldquo;删除中&rdquo; 被设置后， 垃圾回收器就会删除它的从属对象。 当垃圾回收器删除所有 &ldquo;阻塞&rdquo; 的对象(包含 <code>ownerReference.blockOwnerDeletion=true</code> 的对象)后，
就会删除对象本身。</p>
<p>要注意到 <em>前台级联删除</em> 只会被那些包含 <code>ownerReference.blockOwnerDeletion=true</code> 对象的删除所阻塞。
在 k8s <code>v1.7</code> 添加了 <a href="/k8sDocs/reference/access-authn-authz/admission-controllers/#ownerreferencespermissionenforcement">admission controller</a>
其上添加了基于所有者对象上的删除权限设置用户对 <code>blockOwnerDeletion</code> 设置为 true 的权限。
因此对于未授权的从属对象不会延迟其所有者对象的删除。</p>
<p>如果一个对象的 <code>ownerReferences</code> 字段是由控制器(如 Deployment 或 ReplicaSet) 设置的，
<code>blockOwnerDeletion</code> 也会自动被设置，用户不需要手动修改该字段。</p>
<!--
### Background cascading deletion

In *background cascading deletion*, Kubernetes deletes the owner object
immediately and the garbage collector then deletes the dependents in
the background.
 -->
<h3 id="后台级联删除">后台级联删除</h3>
<p>在使用 <em>后台级联删除</em>, k8s 立马删除所有者对象，然后垃圾回器后台删除其从属对象</p>
<!--
### Setting the cascading deletion policy

To control the cascading deletion policy, set the `propagationPolicy`
field on the `deleteOptions` argument when deleting an Object. Possible values include "Orphan",
"Foreground", or "Background".

Here's an example that deletes dependents in background:

```shell
kubectl proxy --port=8080
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset \
  -d '{"kind":"DeleteOptions","apiVersion":"v1","propagationPolicy":"Background"}' \
  -H "Content-Type: application/json"
```

Here's an example that deletes dependents in foreground:

```shell
kubectl proxy --port=8080
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset \
  -d '{"kind":"DeleteOptions","apiVersion":"v1","propagationPolicy":"Foreground"}' \
  -H "Content-Type: application/json"
```

Here's an example that orphans dependents:

```shell
kubectl proxy --port=8080
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset \
  -d '{"kind":"DeleteOptions","apiVersion":"v1","propagationPolicy":"Orphan"}' \
  -H "Content-Type: application/json"
```

kubectl also supports cascading deletion.
To delete dependents automatically using kubectl, set `--cascade` to true.  To
orphan dependents, set `--cascade` to false. The default value for `--cascade`
is true.

Here's an example that orphans the dependents of a ReplicaSet:

```shell
kubectl delete replicaset my-repset --cascade=false
```
 -->
<h3 id="设置级联删除策略">设置级联删除策略</h3>
<p>想要控制级联删除策略, 可以在删除对象时设置 <code>deleteOptions</code> 参数的 <code>propagationPolicy</code> 字段，
可选的值有 &ldquo;Orphan&rdquo;, &ldquo;Foreground&rdquo;, &ldquo;Background&rdquo;.
以下为一个后台删除从属对象的示例:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl proxy --port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span>
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;kind&#34;:&#34;DeleteOptions&#34;,&#34;apiVersion&#34;:&#34;v1&#34;,&#34;propagationPolicy&#34;:&#34;Background&#34;}&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span>
</code></pre></div><p>以下为一个前台删除从属对象的示例:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl proxy --port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span>
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;kind&#34;:&#34;DeleteOptions&#34;,&#34;apiVersion&#34;:&#34;v1&#34;,&#34;propagationPolicy&#34;:&#34;Foreground&#34;}&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span>
</code></pre></div><p>以下为一个将从属对象设置为 孤儿的示例:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl proxy --port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span>
curl -X DELETE localhost:8080/apis/apps/v1/namespaces/default/replicasets/my-repset <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;kind&#34;:&#34;DeleteOptions&#34;,&#34;apiVersion&#34;:&#34;v1&#34;,&#34;propagationPolicy&#34;:&#34;Orphan&#34;}&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span>
</code></pre></div><p>kubectl 也支持级联删除。要使用 kubectl 自动删除从属对象， 设置 <code>--cascade</code> 为 <code>true</code>
将从属对象设置为 孤儿 设置 <code>--cascade</code> 为 <code>false</code>. <code>--cascade</code> 默认值为 <code>true</code></p>
<p>以下为一个将 ReplicaSet 从属对象设置为 孤儿的示例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete replicaset my-repset --cascade<span style="color:#f92672">=</span>false
</code></pre></div><!--
### Additional note on Deployments

Prior to 1.7, When using cascading deletes with Deployments you *must* use `propagationPolicy: Foreground`
to delete not only the ReplicaSets created, but also their Pods. If this type of _propagationPolicy_
is not used, only the ReplicaSets will be deleted, and the Pods will be orphaned.
See [kubeadm/#149](https://github.com/kubernetes/kubeadm/issues/149#issuecomment-284766613) for more information.
 -->
<h3 id="deployment-额外需要注意的地方">Deployment 额外需要注意的地方</h3>
<p>Prior to 1.7, When using cascading deletes with Deployments you <em>must</em> use <code>propagationPolicy: Foreground</code>
to delete not only the ReplicaSets created, but also their Pods. If this type of <em>propagationPolicy</em>
is not used, only the ReplicaSets will be deleted, and the Pods will be orphaned.
See <a href="https://github.com/kubernetes/kubeadm/issues/149#issuecomment-284766613">kubeadm/#149</a> for more information.</p>
<p>在 <code>1.7</code> 版本之前， 当使用级联删除 Deployment 时，<em>必须</em> 要使用 <code>propagationPolicy: Foreground</code>
来确定不止删除创建的  ReplicaSet，还要删除对应的 Pod。如果没有使用该类型的 <em>propagationPolicy</em>，
只有 ReplicaSet 会被删除，Pod 会被设置人孤儿。
更多信息见 <a href="https://github.com/kubernetes/kubeadm/issues/149#issuecomment-284766613">kubeadm/#149</a></p>
<h2 id="已知问题">已知问题</h2>
<p>见问题单 <a href="https://github.com/kubernetes/kubernetes/issues/26120">#26120</a></p>
<h2 id="相关资料">相关资料</h2>
<p><a href="https://git.k8s.io/community/contributors/design-proposals/api-machinery/garbage-collection.md">设计文稿 1</a></p>
<p><a href="https://git.k8s.io/community/contributors/design-proposals/api-machinery/synchronous-garbage-collection.md">设计文稿 2</a></p>
<div class="edit-meta">
Last updated on 31 Aug 2020


<br>
Published on 31 Aug 2020
<br><a href="https://github.com/lostsquirrel/k8sDocs/edit/master/content/concepts/workloads/controllers/garbage-collection.md" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/job/" title="Job"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Job</a>
<a class="nav nav-next" href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/ttlafterfinished/" title="用于已完成资源的 TTL 控制器">Next - 用于已完成资源的 TTL 控制器 <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs">Home</a></li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/setup/">Getting started<span class="mark closed">+</span></a>
  
<ul class="sub-menu">

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/setup/02-production-environment/">Production environment<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/setup/02-production-environment/00-container-runtimes/">Container runtimes</a></li>
</ul>
  
</li>

<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/setup/00-release/">Release notes and version skew</a>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/setup/01-learning-environment/">学习环境<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/setup/01-learning-environment/00-minikube/">使用 Minikube 搭建 K8s环境</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/setup/01-learning-environment/01-kind/">使用 Kind 搭建 K8s环境</a></li>
</ul>
  
</li>
</ul>
  
</li>

<li class="parent has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/">概念(Concepts)<span class="mark opened">-</span></a>
  
<ul class="sub-menu">

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/05-storage/">Storage<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/05-storage/00-volumes/">Volumes</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/">概览<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/00-what-is-k8s/">k8s 是什么</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/01-components/">k8s 组件</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/02-k8s-api/">k8s API 说明</a></li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/">k8s 对象管理<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/00-kubernetes-objects/">k8s 对象介绍</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/names/">对象命令与ID</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/02-namespace/">名字空间(Namespaces)</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/labels/">标签和标签选择器</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/04-annotation/">注解 (Annotations)</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/05-field-selectors/">字段选择器</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/overview/working-with-objects/06-common-labels/">标签设置指导</a></li>
</ul>
  
</li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/01-architecture/">集群架构<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/01-architecture/00-nodes/">节点</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/01-architecture/01-control-plane-node-communication/">控制中心与节点的通信</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/01-architecture/02-controller/">控制器</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/01-architecture/03-cloud-controller/">Cloud Controller Manager</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/containers/">容器<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/containers/00-images/">镜像</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/containers/01-container-environment/">容器环境</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/containers/02-runtime-class/">Runtime Class</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/containers/container-lifecycle-hooks/">容器生命周期钩子</a></li>
</ul>
  
</li>

<li class="parent has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/">工作负载(Workload)<span class="mark opened">-</span></a>
  
<ul class="sub-menu">

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/pods/">Pod<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/pods/pod-lifecycle/">Pod 生命周期</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/pods/init-containers/">初始化容器</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/pods/pod-topology-spread-constraints/">Pod 拓扑分布约束条件</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/pods/podpreset/">Pod 预设信息</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/pods/disruptions/">Disruptions</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/pods/ephemeral-containers/">临时容器</a></li>
</ul>
  
</li>

<li class="parent has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/">控制器<span class="mark opened">-</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/deployment/">Deployment</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/replicaset/">ReplicaSet</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/statefulset/">StatefulSet</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/daemonset/">DaemonSet</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/job/">Job</a></li>
<li class="active"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/garbage-collection/">垃圾回收</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/ttlafterfinished/">用于已完成资源的 TTL 控制器</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/cron-jobs/">CronJob</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/workloads/controllers/replicationcontroller/">ReplicationController</a></li>
</ul>
  
</li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/services-networking/">Service, 负载均衡, 网络<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/services-networking/service/">Service</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/services-networking/service-topology/">Service Topology</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/services-networking/dns-pod-service/">Service 和 Pod 的 DNS</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/08-policy/">Policies<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/08-policy/01-resource-quotas/">资源配额</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/08-policy/02-pod-security-policy/">Pod Security Policies</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/scheduling-eviction/">Scheduling and Eviction<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/scheduling-eviction/00-kube-scheduler/">Kubernetes Scheduler</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/scheduling-eviction/01-taint-and-toleration/">Taints and Tolerations</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/scheduling-eviction/02-assign-pod-node/">Assigning Pods to Nodes</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/10-cluster-administration/">Cluster Administration<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/10-cluster-administration/03-networking/">Cluster Networking</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/concepts/11-extend-kubernetes/">Extending Kubernetes<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/concepts/11-extend-kubernetes/00-extend-cluster/">Extending your Kubernetes Cluster</a></li>
</ul>
  
</li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/">Tasks<span class="mark closed">+</span></a>
  
<ul class="sub-menu">

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/tools/">Install Tools<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/tools/00-install-kubectl/">下载安装配置 kubectl</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/tools/01-install-minikube/">安装 Minikube</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/administer-cluster/">Administer a Cluster<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/administer-cluster/09-running-cloud-controller/">Cloud Controller Manager Administration</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/administer-cluster/14-topology-manager/">Control Topology Management Policies on a node</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/administer-cluster/18-developing-cloud-controller-manager/">Developing Cloud Controller Manager</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/administer-cluster/28-reserve-compute-resources/">Reserve Compute Resources for System Daemons</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/administer-cluster/34-namespaces/">通过名字空间分享一个集群</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/administer-cluster/10-cluster-management/"></a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/configure-pod-container/">Configure Pod Containters<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/configure-pod-container/10-configure-service-account/">Configure Service Accounts for Pods</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/configure-pod-container/11-pull-image-private-registry/">Pull an Image from a Private Registry</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/configure-pod-container/09-security-context/">Configure a Security Context for a Pod or Container</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/configure-pod-container/configure-pod-initialization/"></a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/configure-pod-container/attach-handler-lifecycle-event/">Attach Handlers to Container Lifecycle Events</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">存活(liveness), 就绪(readiness), 启动(startup)探针配置</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/inject-data-application/">Inject Data Into Applications<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/inject-data-application/04-downward-api-volume-expose-pod-information/">Expose Pod Information to Containers Through Files</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/run-application/"><span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/run-application/force-delete-stateful-set-pod/">Force Delete StatefulSet Pods</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/debug-application-cluster/">Monitoring, Logging, and Debugging<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/debug-application-cluster/00-debug-application-introspection/">Application Introspection and Debugging</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/debug-application-cluster/debug-init-containers/">Debug Init Containers</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tasks/extend-kubernetes/">Extend Kubernetes<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tasks/extend-kubernetes/01-setup-konnectivity/">Set up Konnectivity service</a></li>
</ul>
  
</li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/tutorials/">Tutorials<span class="mark closed">+</span></a>
  
<ul class="sub-menu">

<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/tutorials/00-hello-minikube/">Hello Minikube</a>
  
</li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/reference/">Reference<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/glossary/">Standardized Glossary</a></li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/reference/using-api/">Using the Kubernetes API<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/using-api/client-libraries/">Client Libraries</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/reference/03-access-authn-authz/">Accessing the API<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/03-access-authn-authz/01-authentication/">Authenticating</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/03-access-authn-authz/04-admission-controllers/">Using Admission Controllers</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/03-access-authn-authz/07-authorization/">Authorization Overview</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/reference/kubernetes-api/">API Reference<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/kubernetes-api/labels-annotations-taints/">Well-Known Labels, Annotations and Taints</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/reference/command-line-tools-reference/">Feature Gates<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/command-line-tools-reference/feature-gates/">Feature Gates</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/command-line-tools-reference/07-kubelet-authentication-authorization/">Kubelet authentication/authorization</a></li>
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/command-line-tools-reference/08-kubelet-tls-bootstrapping/">TLS bootstrapping</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/reference/scheduling/"><span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/scheduling/profiles/">Scheduling Profiles</a></li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/reference/07-kubectl/">kubectl CLI<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/07-kubectl/00-overview/">kubectl 概览</a></li>
</ul>
  
</li>

<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/reference/10-drivers/">Minikube Drivers</a>
  
</li>
</ul>
  
</li>

<li class=" has-sub-menu"><a href="https://lostsquirrel.github.io/k8sDocs/examples/">Examples<span class="mark closed">+</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://lostsquirrel.github.io/k8sDocs/examples/readme/"></a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
