<!doctype html>
<html lang="zh" class="no-js">
  <head>
    



<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.75.1" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">

<link rel="shortcut icon" type="image/png" href="/k8sDocs/images/favicon.png">
<link rel="apple-touch-icon" href="/k8sDocs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="manifest" href="/k8sDocs/manifest.webmanifest">
<link rel="apple-touch-icon" href="/k8sDocs/images/kubernetes-192x192.png">

<title>使用 Minikube 搭建 K8s环境 | Kubernetes</title><meta property="og:title" content="使用 Minikube 搭建 K8s环境" />
<meta property="og:description" content="特点 一个用于创建易于部署，运行在虚拟机的的本地单节点 k8s 集群的工具 适用场景 尝试与学习 k8s 日常开发 功能特性 DNS NodePorts ConfigMaps and Secrets Dashboards Container Runtime: Docker, CRI-O, and containerd Enabling CNI (Container Network Interface) Ingress 安装" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lostsquirrel.github.io/k8sDocs/setup/01-learning-environment/00-minikube/" />
<meta property="article:published_time" content="2020-06-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-04T17:59:49+08:00" /><meta property="og:site_name" content="Kubernetes" />
<meta itemprop="name" content="使用 Minikube 搭建 K8s环境">
<meta itemprop="description" content="特点 一个用于创建易于部署，运行在虚拟机的的本地单节点 k8s 集群的工具 适用场景 尝试与学习 k8s 日常开发 功能特性 DNS NodePorts ConfigMaps and Secrets Dashboards Container Runtime: Docker, CRI-O, and containerd Enabling CNI (Container Network Interface) Ingress 安装">
<meta itemprop="datePublished" content="2020-06-11T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-01-04T17:59:49+08:00" />
<meta itemprop="wordCount" content="2392">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用 Minikube 搭建 K8s环境"/>
<meta name="twitter:description" content="特点 一个用于创建易于部署，运行在虚拟机的的本地单节点 k8s 集群的工具 适用场景 尝试与学习 k8s 日常开发 功能特性 DNS NodePorts ConfigMaps and Secrets Dashboards Container Runtime: Docker, CRI-O, and containerd Enabling CNI (Container Network Interface) Ingress 安装"/>





<link rel="preload" href="/k8sDocs/scss/main.min.537757ec8e00d87ec206229d5725b6d05e078dd447818e448f0802685603e730.css" as="style">
<link href="/k8sDocs/scss/main.min.537757ec8e00d87ec206229d5725b6d05e078dd447818e448f0802685603e730.css" rel="stylesheet" integrity="">


<script src="/k8sDocs/js/jquery-3.3.1.min.js" ></script>





<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "url": "https://kubernetes.io",
    "logo": "https://kubernetes.io/images/favicon.png",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://lostsquirrel.github.io/k8sDocs/search/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }

  }
</script>
<meta name="theme-color" content="#326ce5">




<link rel="stylesheet" href=/k8sDocs/css/base_fonts.css>

<link rel="stylesheet" href="/k8sDocs/css/jquery-ui.min.css">
<link rel="stylesheet" href="/k8sDocs/css/callouts.css">
<link rel="stylesheet" href="/k8sDocs/css/custom.css">
<link rel="stylesheet" href="/k8sDocs/css/custom-jekyll/tags.css">



<meta name="description" content="特点 一个用于创建易于部署，运行在虚拟机的的本地单节点 k8s 集群的工具 适用场景 尝试与学习 k8s 日常开发 功能特性 DNS NodePorts ConfigMaps and Secrets Dashboards Container Runtime: Docker, CRI-O, and containerd Enabling CNI (Container Network Interface) Ingress 安装">
<meta property="og:description" content="特点 一个用于创建易于部署，运行在虚拟机的的本地单节点 k8s 集群的工具 适用场景 尝试与学习 k8s 日常开发 功能特性 DNS NodePorts ConfigMaps and Secrets Dashboards Container Runtime: Docker, CRI-O, and containerd Enabling CNI (Container Network Interface) Ingress 安装">
<meta name="twitter:description" content="特点 一个用于创建易于部署，运行在虚拟机的的本地单节点 k8s 集群的工具 适用场景 尝试与学习 k8s 日常开发 功能特性 DNS NodePorts ConfigMaps and Secrets Dashboards Container Runtime: Docker, CRI-O, and containerd Enabling CNI (Container Network Interface) Ingress 安装">
<meta property="og:url" content="https://lostsquirrel.github.io/k8sDocs/setup/01-learning-environment/00-minikube/">
<meta property="og:title" content="使用 Minikube 搭建 K8s环境">
<meta name="twitter:title" content="使用 Minikube 搭建 K8s环境">
<meta name="twitter:image" content="https://kubernetes.io/images/favicon.png" />

<meta name="twitter:image:alt" content="Kubernetes">

<meta property="og:image" content="/k8sDocs/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">



<script src="/k8sDocs/js/script.js"></script>


  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark  flex-row td-navbar" data-auto-burger="primary">
        <a class="navbar-brand" href="/k8sDocs/"></a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">

		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			
			
			<li class="nav-item mr-2 mb-lg-0">
				
				<a class="nav-link" href="/k8sDocs/docs/" >Documentation</span></a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
		</ul>
	</div>
  

</nav>

    </header>
    <div class="container-fluid td-default td-outer">
      <main role="main" class="td-main">
        

<h2 id="特点">特点</h2>
<p>一个用于创建易于部署，运行在虚拟机的的本地单节点 k8s 集群的工具</p>
<h2 id="适用场景">适用场景</h2>
<ol>
<li>尝试与学习 k8s</li>
<li>日常开发</li>
</ol>
<h2 id="功能特性">功能特性</h2>
<ul>
<li>DNS</li>
<li>NodePorts</li>
<li>ConfigMaps and Secrets</li>
<li>Dashboards</li>
<li>Container Runtime:
<a href="https://www.docker.com/">Docker</a>,
<a href="https://cri-o.io/">CRI-O</a>, and
<a href="https://github.com/containerd/containerd">containerd</a></li>
<li>Enabling CNI (Container Network Interface)</li>
<li>Ingress</li>
</ul>
<h2 id="安装">安装</h2>
<p><a href="../../3-tasks/00-tools/install-minikube">安装 Minikube</a></p>
<h2 id="快速入门">快速入门</h2>
<p>以下简单介绍 minikube 的基本用法，如启动，使用，删除。</p>
<ol>
<li>启动 minikube 以创建集群</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"> minikube start
</code></pre></div><p>更多运行参数参见后续章节</p>
<ol start="2">
<li>使用 kubectl 进行集群管理，更多见后续章节</li>
</ol>
<p>以下命令使用 <code>echoserver</code> 镜像 创建一个 部署（<code>Deployment</code>）， 这个镜像是一个简单的 <code>http</code> 服务，服务端口 <code>8080</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl create deployment hello-minikube --image<span style="color:#f92672">=</span>k8s.gcr.io/echoserver:1.10
kubectl create deployment hello-minikube --image<span style="color:#f92672">=</span>registry.cn-hangzhou.aliyuncs.com/google_containers/echoserver:1.10
</code></pre></div><p>根据网络选择一条命令执行，输出结果如下</p>
<pre><code>deployment.apps/hello-minikube created
</code></pre><ol start="3">
<li>为了能够访问这个 <code>Deployment，</code> 需要为其创建一个 <code>Service</code></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl expose deployment hello-minikube --type<span style="color:#f92672">=</span>NodePort --port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span>
</code></pre></div><p>其中 <code>--type=NodePort</code> 参数指定服务的类型，输出结果如下</p>
<pre><code>service/hello-minikube exposed
</code></pre><ol start="4">
<li>需要等到 Deployment 对应的 Pod 启动后，才能在 <code>Service</code> 访问</li>
</ol>
<p>检查 Pod 是否为 运行(running) 状态,执行如下命令</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get pod
</code></pre></div><p>如果输出的 STATUS 列值为 ContainerCreating, 表示 Pod 还在创建中，需要再等一会儿，类似如下</p>
<pre><code>NAME                              READY     STATUS              RESTARTS   AGE
hello-minikube-3383150820-vctvh   0/1       ContainerCreating   0          3s
</code></pre><p>如果输出的 STATUS 列值为 Running, 表示 Pod 启动完成，运行中，类似如下</p>
<pre><code>NAME                              READY     STATUS    RESTARTS   AGE
hello-minikube-3383150820-vctvh   1/1       Running   0          13s
</code></pre><ol start="5">
<li>获取 Service 的访问连接信息</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube service hello-minikube --url
</code></pre></div><p>输出结果类型如下</p>
<pre><code>http://172.17.0.3:31579
</code></pre><p>通过浏览器访问以下连接地址，输出类似如下</p>
<pre><code>
Hostname: hello-minikube-7df785b6bb-kjtnt

Pod Information:
 -no pod information available-

Server values:
 server_version=nginx: 1.13.3 - lua: 10008

Request Information:
 client_address=172.18.0.1
 method=GET
 real path=/
 query=
 request_version=1.1
 request_scheme=http
 request_uri=http://127.0.0.1:8080/

Request Headers:
 accept=*/*
 host=127.0.0.1:31579
 user-agent=curl/7.65.3

Request Body:
 -no body in request-
</code></pre><p>如果不需要这个服务，删除对应对象</p>
<ol start="7">
<li>删除 <code>hello-minikube</code> <code>Service</code></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl delete services hello-minikube
</code></pre></div><p>输出如下</p>
<pre><code>service &quot;hello-minikube&quot; deleted
</code></pre><ol start="8">
<li>删除 <code>hello-minikube</code> <code>Deployment</code>:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl delete deployment hello-minikube
</code></pre></div><p>输出如下</p>
<pre><code>deployment.extensions &quot;hello-minikube&quot; deleted
</code></pre><ol start="9">
<li>停止本地集群</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube stop
</code></pre></div><p>输出如下</p>
<pre><code>Stopping &quot;minikube&quot;...
&quot;minikube&quot; stopped.
</code></pre><ol start="10">
<li>删除本地集群</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube delete
</code></pre></div><p>输出如下</p>
<pre><code>Deleting &quot;minikube&quot; ...
The &quot;minikube&quot; cluster has been deleted.
</code></pre><p>后续章节还有更多关于 集群删除的内容</p>
<h2 id="集群管理">集群管理</h2>
<h3 id="集群启动">集群启动</h3>
<p>通过 <code>minikube start</code> 命令启动集群，包含创建和配置一个虚拟机(也可以是其它方式)来运行一个单节点的 k8s 集群。 同时添加 kubectl 与集群交互的配置</p>
<p>注意:</p>
<ol>
<li>如果需要使用代理命令如下,单独配置的环境变量不会生效</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">shell https_proxy<span style="color:#f92672">=</span>&lt;my proxy&gt; minikube start --docker-env http_proxy<span style="color:#f92672">=</span>&lt;my proxy&gt; --docker-env https_proxy<span style="color:#f92672">=</span>&lt;my proxy&gt; --docker-env no_proxy<span style="color:#f92672">=</span>192.168.99.0/24
</code></pre></div><ol start="2">
<li>kubectl 配置会生成一个叫  <code>minikube</code> 的上下文，并作为默认的上下文，如果需要切换为该上下文执行命令 <code>kubectl config use-context minikube</code></li>
</ol>
<h3 id="指定-k8s-版本">指定 k8s 版本</h3>
<p>可以通过为 <code>minikube start</code> 的 <code>--kubernetes-version</code> 选项指定集群的 k8s 版本，例如以下命令表示指定 k8s 版本为 <code>v1.18.0</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube start --driver<span style="color:#f92672">=</span>&lt;driver_name&gt;
</code></pre></div><h3 id="指定虚拟机驱动">指定虚拟机驱动</h3>
<p>可以通过为 <code>minikube start</code> 的 <code>--driver=&lt;enter_driver_name&gt;</code> 选项指定集群组件宿主机的实现方式，命令类似如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube start --driver<span style="color:#f92672">=</span>&lt;driver_name&gt;
</code></pre></div><p>minikube 支持驱动如下:
注意： 驱动详情及插件安装见 <a href="https://minikube.sigs.k8s.io/docs/reference/drivers/">这里</a></p>
<ul>
<li>docker (driver installation)</li>
<li>virtualbox (driver installation)</li>
<li>podman (driver installation) (EXPERIMENTAL)</li>
<li>vmwarefusion</li>
<li>kvm2 (driver installation)</li>
<li>hyperkit (driver installation)</li>
<li>hyperv (driver installation) Note that the IP below is dynamic and can change. It can be retrieved with - minikube ip.</li>
<li>vmware (driver installation) (VMware unified driver)</li>
<li>parallels (driver installation)</li>
<li>none(直接将k8s组件运行在主机上，需要主机系统为 Linux 且安装了 Docker)</li>
</ul>
<p>警告: 如果使用驱动为 none 时， 某些 k8s 组件容器以超级权限(privileged)运行，会对 minikube 之外的环境产生影响。因此不建议在个人工作站上使用</p>
<h3 id="通过其它的容器运行环境启动集群">通过其它的容器运行环境启动集群</h3>
<ul>
<li>containerd</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube start <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --network-plugin<span style="color:#f92672">=</span>cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --enable-default-cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --container-runtime<span style="color:#f92672">=</span>containerd <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --bootstrapper<span style="color:#f92672">=</span>kubeadm
</code></pre></div><p>或者</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube start <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --network-plugin<span style="color:#f92672">=</span>cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --enable-default-cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --extra-config<span style="color:#f92672">=</span>kubelet.container-runtime<span style="color:#f92672">=</span>remote <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --extra-config<span style="color:#f92672">=</span>kubelet.container-runtime-endpoint<span style="color:#f92672">=</span>unix:///run/containerd/containerd.sock <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --extra-config<span style="color:#f92672">=</span>kubelet.image-service-endpoint<span style="color:#f92672">=</span>unix:///run/containerd/containerd.sock <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --bootstrapper<span style="color:#f92672">=</span>kubeadm
</code></pre></div><ul>
<li>CRI-O</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube start <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --network-plugin<span style="color:#f92672">=</span>cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --enable-default-cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --container-runtime<span style="color:#f92672">=</span>cri-o <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --bootstrapper<span style="color:#f92672">=</span>kubeadm
</code></pre></div><p>或者</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube start <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --network-plugin<span style="color:#f92672">=</span>cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --enable-default-cni <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --extra-config<span style="color:#f92672">=</span>kubelet.container-runtime<span style="color:#f92672">=</span>remote <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --extra-config<span style="color:#f92672">=</span>kubelet.container-runtime-endpoint<span style="color:#f92672">=</span>/var/run/crio.sock <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --extra-config<span style="color:#f92672">=</span>kubelet.image-service-endpoint<span style="color:#f92672">=</span>/var/run/crio.sock <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --bootstrapper<span style="color:#f92672">=</span>kubeadm
</code></pre></div><h3 id="对过重用-minkube-使用的-docker-daemon访问集群内部镜像">对过重用 minkube 使用的 Docker daemon，访问集群内部镜像</h3>
<p>在使用单个虚拟的k8s集群时，重启 minikube 内置的 Docker 后台来避免在你构建自己的镜像的时候需要使用的镜像仓库,这样可以简化操作，加快本地操作体验</p>
<p>注意: 不要使用 <code>latest</code> 作为镜像的标签，因为它是默认值。在镜像摘取策略为 <code>Always</code>的时候可能会出问题。</p>
<p>在 <code>Mac/Linux</code> 主机下可以通过 <code>minikube docker-env</code> 命令返回结果，切换 Docker 后台，切换后可以通过以下命令查看其中镜像</p>
<pre><code>docker ps
</code></pre><p>注意:  Centos 7，可能会报如下错误</p>
<pre><code> Could not read CA certificate &quot;/etc/docker/ca.pem&quot;: open /etc/docker/ca.pem: no such file or directory
</code></pre><p>可以通过修改 <code>/etc/sysconfig/docker</code>, 确保环境变量与 minikube 的一致，脚本类似如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">shell &lt; DOCKER_CERT_PATH<span style="color:#f92672">=</span>/etc/docker --- &gt; <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>DOCKER_CERT_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> &gt; DOCKER_CERT_PATH<span style="color:#f92672">=</span>/etc/docker &gt; <span style="color:#66d9ef">fi</span>
</code></pre></div><h3 id="初始化时对-k8s-配置">初始化时对 k8s 配置</h3>
<p>在通过 <code>minikube start</code> 初始化集群时可能通过  <code>--extra-config</code> 系列选择实现对集群组件的配置
如果我多个配置，个多次使用该选项， 选项值格式为 <code>component.key=value</code>， <code>component</code> 范围见以下列表， <code>key</code> 和 <code>value</code> 见明细</p>
<ul>
<li>kubelet TODO</li>
<li>apiserver TODO</li>
<li>proxy TODO</li>
<li>controller-manager TODO</li>
<li>etcd TODO</li>
<li>scheduler TODO</li>
</ul>
<p><code>key</code> 的可用值具体见以上各模块文档的 <code>componentconfigs</code> 部分</p>
<h4 id="示例">示例</h4>
<ul>
<li>
<p><code>--extra-config=kubelet.MaxPods=5</code> 将 kubelet 的最大 <code>Pod</code> 数设置为 <code>5</code> (minikube 实验时设置大些(单节点原因)，不然后出事)</p>
</li>
<li>
<p><code>--extra-config=scheduler.LeaderElection.LeaderElect=true</code> 将 scheduler 选举开启(该配置支持结构体嵌套配置)，配置作用见 TODO</p>
</li>
<li>
<p><code>--extra-config=apiserver.authorization-mode=RBAC</code> 将 apiserver 的 AuthorizationMode 设置为 RBAC， 设置认证模式</p>
</li>
</ul>
<h3 id="停止集群">停止集群</h3>
<p><code>minikube stop</code> 用于停止集群。 它会关闭其启动的虚拟机，但保存集群的所有状态和数据。再次开启可以恢复集群之前的状态</p>
<h3 id="删除集群">删除集群</h3>
<p><code>minikube delete</code> 用于删除集群，它全关闭并销毁虚拟机，所有数据和状态都会消失</p>
<h3 id="minikube-升级">minikube 升级</h3>
<p>具体根据安装方式不同有不同的升级方式</p>
<h2 id="集群管理-1">集群管理</h2>
<h3 id="kubectl">kubectl</h3>
<p><code>minikube start</code> 命令创建集群时会为 kubectl 添加对应的该集群的上下文配置。且该集群会被设置为默认上下文。
如果切换到其它上下文后想切换回该集群可以通过以下命令</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl config use-context minikube
</code></pre></div><p>可在命令参数中指定该上下文</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get pods --context<span style="color:#f92672">=</span>minikube
</code></pre></div><h3 id="dashboard">Dashboard</h3>
<p>在集群创建好后，可以通过 <code>minikube dashboard</code> 命令获得 <code>Kubernetes Dashboard</code>访问地址</p>
<h3 id="services">Services</h3>
<p>在创建类型为 NodePort 的 Service 后，可以通过 <code>minikube service [-n NAMESPACE] [--url] NAME</code> 命令，获得其访问地址</p>
<h2 id="网络">网络</h2>
<p>minikube 创建的虚拟机通过 <code>host-only</code> 网络模式与主机通信。 可以通过 <code>minikube ip</code> 获得
类型为 NodePort 的 Service 可以通过 这个IP 和对应的端口进行访问</p>
<h2 id="持久化卷">持久化卷</h2>
<p>minikube 支持的 持久化卷 的类型为 <code>hostPath</code>， 该类型持久化卷直接关联虚拟机内的目录</p>
<p>minikube 创建的虚拟机以 <code>tmpfs</code> 启动，所以多数目录会在重启后消失(<code>minikube stop</code>), 但如下目录及文件都会一直存在</p>
<ul>
<li>/data</li>
<li>/var/lib/minikube</li>
<li>/var/lib/docker</li>
</ul>
<p>以下示例为创建一个映射到 <code>/data</code> 目录的持久化卷</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pv0001</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">accessModes</span>:
    - <span style="color:#ae81ff">ReadWriteOnce</span>
  <span style="color:#f92672">capacity</span>:
    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Gi</span>
  <span style="color:#f92672">hostPath</span>:
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/data/pv0001/</span>
</code></pre></div><h2 id="被挂载的主机目录">被挂载的主机目录</h2>
<table>
<thead>
<tr>
<th>有些 minikube 驱动会将主机目录挂载到虚拟机中，方便文件共享，该特性目前不提供配置且不同系统也不尽相同，具体如下</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Driver</td>
<td>OS</td>
<td>HostFolder</td>
<td>VM</td>
</tr>
<tr>
<td>VirtualBox</td>
<td>Linux</td>
<td>/home</td>
<td>/hosthome</td>
</tr>
<tr>
<td>VirtualBox</td>
<td>macOS</td>
<td>/Users</td>
<td>/Users</td>
</tr>
<tr>
<td>VirtualBox</td>
<td>Windows</td>
<td>C://Users</td>
<td>/c/Users</td>
</tr>
<tr>
<td>VMware Fusion</td>
<td>macOS</td>
<td>/Users</td>
<td>/mnt/hgfs/Users</td>
</tr>
<tr>
<td>Xhyve</td>
<td>macOS</td>
<td>/Users</td>
<td>/Users</td>
</tr>
</tbody>
</table>
<p>注意： KVM 目前还不支持主机目录挂载</p>
<h2 id="私有镜像仓库">私有镜像仓库</h2>
<p>如何访问私有镜像仓库 看这里 TODO</p>
<p>使用镜像仓库时推荐使用 <code>ImagePullSecrets</code> 方式。 如果想在虚拟机中配置，则可以配置在<code>/home/docker.dockercfg</code> 或 <code>/home/docker/.docker/config.json</code> 文件中</p>
<h2 id="插件">插件</h2>
<p>如果希望在启动或重启时加载自定义插件，可以将其放在 <code>~/.minikube/addons</code> 目录。 这个目录中的插件会在 minikube 启动(或重启)虚拟机是加载到虚拟机中</p>
<h2 id="使用-http-代理">使用 HTTP 代理</h2>
<p>在minikube 启动的虚拟机中，包含了 k8s 组件和 Docker daemon, 当 k8s 调度容器到 Docker, 而 Docker 需要外部网络在能拉到镜像时。而外部网络需要配置 HTTP 代理才能访问时，可以通过在 minikube start 启动添加参数配置代理，示例如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">minikube start --docker-env http_proxy<span style="color:#f92672">=</span>http://$YOURPROXY:PORT <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                 --docker-env https_proxy<span style="color:#f92672">=</span>https://$YOURPROXY:PORT
</code></pre></div><p>但如果配置了代理可能会让 <code>kubectl</code> 连接不到虚拟机，需要添加如下配置后再用 <code>minikube start</code> 启动</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">export no_proxy<span style="color:#f92672">=</span>$no_proxy,<span style="color:#66d9ef">$(</span>minikube ip<span style="color:#66d9ef">)</span>
</code></pre></div><h2 id="已知问题">已知问题</h2>
<p>minikube 不支持需要多节点的特性</p>
<h2 id="设计">设计</h2>
<p>minikube 使用 libmachine 配置虚拟机， 通过 kubeadm 管理 k8s 集群创建
更多信息看<a href="https://git.k8s.io/community/contributors/design-proposals/cluster-lifecycle/local-cluster-ux.md">这里</a></p>



      </main>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>











<script src="/k8sDocs/js/main.min.446a2e681f8167f44314691b77368dd561bf0b67514487f3f0fd999316c6da4a.js" integrity="sha256-RGouaB&#43;BZ/RDFGkbdzaN1WG/C2dRRIfz8P2ZkxbG2ko=" crossorigin="anonymous"></script>




  </body>
</html>